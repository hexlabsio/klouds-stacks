{"Parameters":{"UniqueId":{"Type":"String"},"KloudsUserIdentifier":{"Type":"String","Description":"A temporary ID used to refer back to the user that requested this in app, do not change."},"ConnectorPrincipalId":{"Type":"String","Description":"The principal that is allowed to assume this role, do not change."},"ConnectorExternalId":{"Type":"String","Description":"The external id used to match the connector when assuming this role, do not change."},"ConnectorEndpoint":{"Type":"String","Description":"The endpoint to send the role arn to when complete so kloud.io can assume this role, do not change."},"ReportBucket":{"Type":"String","Description":""}},"Resources":{"KloudsConnectInit":{"Type":"Custom::KloudsConnectInit","Properties":{"ServiceToken":{"Ref":"ConnectorEndpoint"},"UserIdentifier":{"Ref":"KloudsUserIdentifier"},"Type":"Init"}},"Role":{"Type":"AWS::IAM::Role","DependsOn":["KloudsConnectInit"],"Properties":{"RoleName":{"Fn::Join":["",["klouds-connector-",{"Ref":"UniqueId"}]]},"AssumeRolePolicyDocument":{"Statement":[{"Effect":"Allow","Principal":{"AWS":[{"Ref":"ConnectorPrincipalId"}]},"Action":"sts:AssumeRole","Condition":{"StringEquals":{"sts:ExternalId":{"Ref":"ConnectorExternalId"}}}}]},"ManagedPolicyArns":["arn:aws:iam::aws:policy/SecurityAudit"],"Policies":[{"PolicyName":"APIGatewayGETDomainNamePolicy","PolicyDocument":{"Version":"2012-10-17","Statement":[{"Action":"apigateway:GET","Effect":"Allow","Resource":["arn:aws:apigateway:*::/domainnames","arn:aws:apigateway:*::/domainnames/*","arn:aws:apigateway:*::/domainnames/*/basepathmappings","arn:aws:apigateway:*::/domainnames/*/basepathmappings/*"]}]}},{"PolicyName":"CostReportPolicy","PolicyDocument":{"Statement":[{"Action":["s3:ListBucket","s3:GetObject"],"Effect":"Allow","Resource":[{"Fn::Join":["",["arn:aws:s3:::",{"Ref":"ReportBucket"}]]},{"Fn::Join":["",["arn:aws:s3:::",{"Ref":"ReportBucket"},"/*"]]}]}],"Version":"2012-10-17"}}]}},"KloudsConnector":{"Type":"Custom::KloudsConnector","DependsOn":["Role"],"Properties":{"ServiceToken":{"Ref":"ConnectorEndpoint"},"RoleArn":{"Fn::GetAtt":["Role","Arn"]},"UserIdentifier":{"Ref":"KloudsUserIdentifier"},"ReportBucket":{"Ref":"ReportBucket"},"StackId":{"Ref":"AWS::StackId"},"Region":{"Ref":"AWS::Region"}}}},"Outputs":{"KloudsConnectorRoleArn":{"Description":"Role used by kloud.io to read resources","Value":{"Fn::GetAtt":["Role","Arn"]}},"KloudsReportBucket":{"Description":"The bucket where AWS will create reports","Value":{"Ref":"ReportBucket"}}},"Description":"Creates a cross-account IAM Role with READONLY access for use by klouds.io"}